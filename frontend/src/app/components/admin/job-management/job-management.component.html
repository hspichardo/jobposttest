<!-- Generated with AI assistance - Job management template with PrimeNG DataTable -->
<div class="container-fluid p-4">
  
  <!-- Header -->
  <div class="flex justify-content-between align-items-center mb-4">
    <h1 class="text-3xl font-bold text-primary m-0">Gestión de Trabajos</h1>
    <p-button 
      label="Crear Trabajo" 
      icon="pi pi-plus" 
      (onClick)="createJob()"
      styleClass="p-button-success">
    </p-button>
  </div>

  <!-- Filtros -->
  <p-card header="Filtros" styleClass="mb-4">
    <div class="grid p-fluid">
      <div class="col-12 md:col-4">
        <label for="search" class="block text-900 font-medium mb-2">Buscar</label>
        <input 
          id="search"
          type="text" 
          pInputText 
          [(ngModel)]="searchText"
          (input)="onFilterChange()"
          placeholder="Buscar por título, descripción..."
          styleClass="w-full">
      </div>
      <div class="col-12 md:col-4">
        <label for="category" class="block text-900 font-medium mb-2">Categoría</label>
        <p-dropdown 
          id="category"
          [(ngModel)]="selectedCategory"
          (onChange)="onFilterChange()"
          [options]="categories" 
          optionLabel="label" 
          optionValue="value"
          placeholder="Seleccionar categoría"
          styleClass="w-full">
        </p-dropdown>
      </div>
      <div class="col-12 md:col-4 flex align-items-end">
        <p-button 
          label="Limpiar Filtros" 
          icon="pi pi-filter-slash" 
          (onClick)="clearFilters()"
          styleClass="p-button-outlined w-full">
        </p-button>
      </div>
    </div>
  </p-card>

  <!-- Tabla de trabajos -->
  <p-card>
    <p-table 
      [value]="jobs" 
      [loading]="loading"
      [paginator]="true"
      [rows]="rows"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="loadJobs($event)"
      [first]="first"
      [rowsPerPageOptions]="[10, 20, 50]"
      styleClass="p-datatable-gridlines"
      [tableStyle]="{'min-width': '50rem'}"
      responsiveLayout="scroll">
      
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="title">
            Título <p-sortIcon field="title"></p-sortIcon>
          </th>
          <th pSortableColumn="category">
            Categoría <p-sortIcon field="category"></p-sortIcon>
          </th>
          <th pSortableColumn="location">
            Ubicación <p-sortIcon field="location"></p-sortIcon>
          </th>
          <th pSortableColumn="is_active">
            Estado <p-sortIcon field="is_active"></p-sortIcon>
          </th>
          <th pSortableColumn="applications_count">
            Aplicaciones <p-sortIcon field="applications_count"></p-sortIcon>
          </th>
          <th pSortableColumn="created_at">
            Fecha Creación <p-sortIcon field="created_at"></p-sortIcon>
          </th>
          <th style="min-width: 12rem;">Acciones</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-job>
        <tr>
          <td>
            <span class="font-medium">{{ job.title }}</span>
            <div class="text-sm text-600 mt-1">
              {{ job.description | slice:0:100 }}...
            </div>
          </td>
          <td>
            <p-tag 
              [value]="getCategoryLabel(job.category)"
              severity="info">
            </p-tag>
          </td>
          <td>
            <i class="pi pi-map-marker mr-2 text-500"></i>
            {{ job.location }}
          </td>
          <td>
            <p-tag 
              [value]="getStatusLabel(job.is_active)"
              [severity]="getStatusSeverity(job.is_active)">
            </p-tag>
          </td>
          <td>
            <div class="flex align-items-center">
              <p-badge 
                [value]="job.applications_count.toString()"
                severity="info">
              </p-badge>
              <p-button 
                *ngIf="job.applications_count > 0"
                icon="pi pi-eye"
                styleClass="p-button-text p-button-sm ml-2"
                (onClick)="viewApplications(job)"
                pTooltip="Ver aplicaciones">
              </p-button>
            </div>
          </td>
          <td>
            {{ formatDate(job.created_at) }}
          </td>
          <td>
            <div class="flex gap-2">
              <p-button 
                icon="pi pi-pencil"
                styleClass="p-button-rounded p-button-text p-button-sm"
                (onClick)="editJob(job)"
                pTooltip="Editar">
              </p-button>
              <p-button 
                [icon]="job.is_active ? 'pi pi-eye-slash' : 'pi pi-eye'"
                [styleClass]="'p-button-rounded p-button-text p-button-sm ' + (job.is_active ? 'p-button-warning' : 'p-button-success')"
                (onClick)="toggleJobStatus(job)"
                [pTooltip]="job.is_active ? 'Desactivar' : 'Activar'">
              </p-button>
              <p-button 
                icon="pi pi-trash"
                styleClass="p-button-rounded p-button-text p-button-sm p-button-danger"
                (onClick)="confirmDelete(job)"
                pTooltip="Eliminar">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center p-4">
            <div class="flex flex-column align-items-center">
              <i class="pi pi-briefcase text-4xl text-400 mb-3"></i>
              <span class="text-lg text-600">No se encontraron trabajos</span>
              <p-button 
                label="Crear Primer Trabajo" 
                icon="pi pi-plus" 
                (onClick)="createJob()"
                styleClass="p-button-outlined mt-3">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      
    </p-table>
  </p-card>

</div>

<!-- Toast para mensajes -->
<p-toast></p-toast>

<!-- Diálogo de confirmación -->
<p-confirmDialog 
  header="Confirmación" 
  icon="pi pi-exclamation-triangle"
  acceptButtonStyleClass="p-button-danger"
  rejectButtonStyleClass="p-button-outlined">
</p-confirmDialog>
